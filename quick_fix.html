<!DOCTYPE html>
<html>
<head>
    <title>快速修复</title>
</head>
<body>
    <h1>快速修复堆垛机卡住问题</h1>
    <button onclick="fixStacker()">修复堆垛机</button>
    <div id="result"></div>
    
    <script>
        async function fixStacker() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '正在修复...';
            
            try {
                // 1. 模拟堆垛机忙碌
                await fetch('/api/modbus/write/4002', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ value: 1 })
                });
                console.log('堆垛机状态设置为忙碌');
                
                // 2. 模拟堆垛机入库进度
                await fetch('/api/modbus/write/4004', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ value: 1 })
                });
                console.log('堆垛机入库进度设置为进行中');
                
                // 等待2秒
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // 3. 模拟堆垛机完成
                await fetch('/api/modbus/write/4006', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ value: 1 })
                });
                console.log('堆垛机入库完成设置为完成');
                
                // 等待2秒
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // 4. 强制检查完成状态
                await fetch('/api/stacker-monitor/check-completion', { method: 'POST' });
                console.log('强制检查完成状态');
                
                resultDiv.innerHTML = '修复完成！请刷新堆垛机监控页面查看结果。';
                
            } catch (error) {
                resultDiv.innerHTML = '修复失败: ' + error.message;
                console.error('修复失败:', error);
            }
        }
    </script>
</body>
</html>
